-- ä½ç½®: Workspace -> ShopNPC -> NPC_ServerScript
local npc = script.Parent
local prompt = npc:WaitForChild("ProximityPrompt")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local remoteEvent = ReplicatedStorage:WaitForChild("RemoteEvent"):WaitForChild("ToggleWindow")

-- â— æ–°æ–¹æ¡ˆï¼šç›´æ¥ä½¿ç”¨ NPC çš„åå­—ä½œä¸ºç±»å‹
local npcType = npc.Name 
print("NPCåç§°ä½œä¸ºç±»å‹: " .. npcType)

-- å½“ç©å®¶æŒ‰ä¸‹ E é”®
prompt.Triggered:Connect(function(player)
	-- [æ–°å¢] æ£€æŸ¥ç©å®¶æ˜¯å¦å¼€å¯äº† PvP
	local isPvP = player:GetAttribute("PvPEnabled")

	if isPvP then
		print("ğŸš« [NPC] æ‹’ç»æœåŠ¡: ç©å®¶å¤„äº PvP æ¨¡å¼")

		-- å‘é€æç¤ºç»™ç©å®¶ (ä½¿ç”¨ RemoteEvent é€šçŸ¥å®¢æˆ·ç«¯å¼¹çª—æˆ–æ˜¾ç¤ºæ–‡å­—)
		local pvpEvent = ReplicatedStorage:FindFirstChild("PvPEvent")
		if pvpEvent then
			pvpEvent:FireClient(player, "Error", "æˆ˜æ–—çŠ¶æ€ä¸‹æ— æ³•äº¤æ˜“ï¼è¯·å…ˆå…³é—­ PvPã€‚")
		end

		return -- âš ï¸ ç›´æ¥ç»“æŸï¼Œä¸æ‰§è¡Œä¸‹é¢çš„å•†åº—é€»è¾‘
	end

	-- [åŸæœ‰é€»è¾‘] ä¸‹é¢æ˜¯ä½ åŸæ¥çš„å•†åº—ä»£ç ï¼Œä¿æŒä¸å˜
	print("ğŸ–±ï¸ [æœåŠ¡å™¨] ç©å®¶ " .. player.Name .. " æ‰“å¼€äº†å•†åº—")
	local shopEvent = ReplicatedStorage:FindFirstChild("ShopEvent") -- å‡è®¾ä½ çš„å•†åº—äº‹ä»¶
	if shopEvent then
		shopEvent:FireClient(player, "OpenShop", "Weapons") 
	end
end)