-- ä½ç½®: Workspace -> ShopNPC -> NPC_ServerScript
local npc = script.Parent
local prompt = npc:WaitForChild("ProximityPrompt")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- 1. è·å–æ­£ç¡®çš„è¿œç¨‹äº‹ä»¶ (å¯¹åº”å®¢æˆ·ç«¯çš„ CyberShopController)
local remoteFolder = ReplicatedStorage:WaitForChild("RemoteEvent", 10)
if not remoteFolder then
	-- å¦‚æœæ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œå°è¯•ç›´æ¥æ‰¾ (å…¼å®¹æ—§ç»“æ„)
	warn("âš ï¸ RemoteEvent æ–‡ä»¶å¤¹æœªæ‰¾åˆ°ï¼Œå°è¯•ç›´æ¥æŸ¥æ‰¾ ToggleWindow")
end

-- ä¼˜å…ˆä»æ–‡ä»¶å¤¹æ‰¾ï¼Œæ‰¾ä¸åˆ°åˆ™åœ¨æ ¹ç›®å½•æ‰¾
local remoteEvent = (remoteFolder and remoteFolder:FindFirstChild("ToggleWindow")) 
	or ReplicatedStorage:FindFirstChild("ToggleWindow")

-- 2. NPC ç±»å‹å®šä¹‰
local npcType = npc.Name 
print("âœ… NPCè„šæœ¬å·²åŠ è½½: " .. npcType)

-- å½“ç©å®¶æŒ‰ä¸‹ E é”®
prompt.Triggered:Connect(function(player)
	-- ==========================================
	-- [PVP æ£€æŸ¥] æˆ˜æ–—ä¸­ç¦æ­¢äº¤æ˜“
	-- ==========================================
	local isPvP = player:GetAttribute("PvPEnabled")

	if isPvP then
		print("ğŸš« [NPC] æ‹’ç»æœåŠ¡: ç©å®¶å¤„äº PvP æ¨¡å¼")
		local pvpEvent = ReplicatedStorage:FindFirstChild("PvPEvent")
		if pvpEvent then
			pvpEvent:FireClient(player, "Error", "æˆ˜æ–—çŠ¶æ€ä¸‹æ— æ³•äº¤æ˜“ï¼è¯·å…ˆå…³é—­ PvPã€‚")
		end
		return 
	end

	-- ==========================================
	-- [æ‰“å¼€å•†åº—] æ ¸å¿ƒä¿®å¤éƒ¨åˆ†
	-- ==========================================
	print("ğŸ›’ [æœåŠ¡å™¨] ç©å®¶ " .. player.Name .. " è¯·æ±‚äº¤æ˜“")

	if remoteEvent then
		-- å‚æ•°1: VendorType (ç”¨äºå®¢æˆ·ç«¯åˆ¤æ–­å–ä»€ä¹ˆ, å¦‚ "SkinSeller" æˆ–å…¶ä»–)
		-- å‚æ•°2: NPC Name (ç”¨äºæ˜¾ç¤ºåœ¨UIæ ‡é¢˜ä¸Š)
		remoteEvent:FireClient(player, npcType, npc.Name)
	else
		warn("âŒ è‡´å‘½é”™è¯¯: æ‰¾ä¸åˆ° 'ToggleWindow' RemoteEventï¼æ— æ³•æ‰“å¼€å•†åº—ã€‚")
		-- å°è¯•ç´§æ€¥ä¿®å¤ï¼šå¦‚æœä½ çš„é¡¹ç›®ç»“æ„ä¸åŒï¼Œå¯èƒ½æ˜¯ ShopEvent
		local fallbackEvent = ReplicatedStorage:FindFirstChild("ShopEvent")
		if fallbackEvent then
			fallbackEvent:FireClient(player, "Open", "Weapons")
		end
	end
end)