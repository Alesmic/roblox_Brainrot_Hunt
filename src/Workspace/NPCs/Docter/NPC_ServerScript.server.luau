-- ä½ç½®: Workspace -> DoctorNPC -> NPC_ServerScript (æœåŠ¡å™¨è„šæœ¬)
local npc = script.Parent
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- 1. è·å– RemoteEvent æ–‡ä»¶å¤¹
local RemoteEventFolder = ReplicatedStorage:WaitForChild("RemoteEvent")

-- âš ï¸ [å…³é”®ä¿®æ”¹] è¿™é‡Œå¿…é¡»æŒ‡å‘ "ToggleHealerWindow"
-- å¦‚æœå†™æˆ "ToggleWindow"ï¼Œå®ƒå°±ä¼šæ‰“å¼€é‚£ä¸ªå–å‰‘çš„æ™®é€šå•†åº—ï¼
local openDoctorEvent = RemoteEventFolder:WaitForChild("ToggleHealerWindow")

-- 2. è·å–äº¤äº’æç¤º
local prompt = npc:FindFirstChild("ProximityPrompt") 
	or (npc:FindFirstChild("HumanoidRootPart") and npc.HumanoidRootPart:FindFirstChild("ProximityPrompt"))

if prompt then
	prompt.Triggered:Connect(function(player)
		-- [æ–°å¢] æ£€æŸ¥ç©å®¶æ˜¯å¦å¼€å¯äº† PvP
		local isPvP = player:GetAttribute("PvPEnabled")

		if isPvP then
			print("ğŸš« [NPC] æ‹’ç»æœåŠ¡: ç©å®¶å¤„äº PvP æ¨¡å¼")

			-- å‘é€æç¤ºç»™ç©å®¶ (ä½¿ç”¨ RemoteEvent é€šçŸ¥å®¢æˆ·ç«¯å¼¹çª—æˆ–æ˜¾ç¤ºæ–‡å­—)
			local pvpEvent = ReplicatedStorage:FindFirstChild("PvPEvent")
			if pvpEvent then
				pvpEvent:FireClient(player, "Error", "æˆ˜æ–—çŠ¶æ€ä¸‹æ— æ³•äº¤æ˜“ï¼è¯·å…ˆå…³é—­ PvPã€‚")
			end

			return -- âš ï¸ ç›´æ¥ç»“æŸï¼Œä¸æ‰§è¡Œä¸‹é¢çš„å•†åº—é€»è¾‘
		end

		-- [åŸæœ‰é€»è¾‘] ä¸‹é¢æ˜¯ä½ åŸæ¥çš„å•†åº—ä»£ç ï¼Œä¿æŒä¸å˜
		print("ğŸ–±ï¸ [æœåŠ¡å™¨] ç©å®¶ " .. player.Name .. " æ‰“å¼€äº†å•†åº—")
		local shopEvent = ReplicatedStorage:FindFirstChild("ShopEvent") -- å‡è®¾ä½ çš„å•†åº—äº‹ä»¶
		if shopEvent then
			shopEvent:FireClient(player, "OpenShop", "Weapons") 
		end
	end)
else
	warn("âŒ DoctorNPC æ‰¾ä¸åˆ° ProximityPrompt")
end