-- ä½ç½®: Workspace -> DoctorNPC -> NPC_ServerScript (æœåŠ¡å™¨è„šæœ¬)
local npc = script.Parent
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- 1. è·å– RemoteEvent æ–‡ä»¶å¤¹
local RemoteEventFolder = ReplicatedStorage:WaitForChild("RemoteEvent")

-- âš ï¸ [å…³é”®] å¿…é¡»æŒ‡å‘ "ToggleHealerWindow" (å¯¹åº”å®¢æˆ·ç«¯ DoctorShop_Local)
local openDoctorEvent = RemoteEventFolder:WaitForChild("ToggleHealerWindow")

-- 2. è·å–äº¤äº’æç¤º
local prompt = npc:FindFirstChild("ProximityPrompt") 
	or (npc:FindFirstChild("HumanoidRootPart") and npc.HumanoidRootPart:FindFirstChild("ProximityPrompt"))

if prompt then
	prompt.Triggered:Connect(function(player)
		-- ==========================================
		-- 1. PvP æ£€æŸ¥ (ä¼˜å…ˆæ‹¦æˆª)
		-- ==========================================
		local isPvP = player:GetAttribute("PvPEnabled")

		if isPvP then
			print("ğŸš« [NPC] æ‹’ç»æœåŠ¡: ç©å®¶å¤„äº PvP æ¨¡å¼")
			local pvpEvent = ReplicatedStorage:FindFirstChild("PvPEvent")
			if pvpEvent then
				pvpEvent:FireClient(player, "Error", "æˆ˜æ–—çŠ¶æ€ä¸‹æ— æ³•æ²»ç–—ï¼è¯·å…ˆå…³é—­ PvPã€‚")
			end
			return -- ğŸ›‘ å¿…é¡»åœ¨è¿™é‡Œç»“æŸ
		end

		-- ==========================================
		-- 2. æ‰“å¼€åŒ»ç”Ÿå•†åº— (æ ¸å¿ƒä¿®å¤)
		-- ==========================================
		print("ğŸš‘ [æœåŠ¡å™¨] ç©å®¶ " .. player.Name .. " è¯·æ±‚æ²»ç–—/è´­ä¹°ç‰©å“")

		-- âŒ é”™è¯¯ä»£ç  (åŸå…ˆçš„):
		-- local shopEvent = ReplicatedStorage:FindFirstChild("ShopEvent")
		-- shopEvent:FireClient(player, "OpenShop", "Weapons") 

		-- âœ… æ­£ç¡®ä»£ç : ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„ openDoctorEvent
		openDoctorEvent:FireClient(player) 
	end)
else
	warn("âŒ DoctorNPC æ‰¾ä¸åˆ° ProximityPrompt")
end